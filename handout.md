```shell
# Listener1 on port 5000 and Listener2 on port 6000
make runL1
make runL2

# server on port 8888
make runS

# control1 and control2
make runC1
make runC2
```



# Service1

ControlMsgService

RPCClient: Snowcast_Control

RPCServer: Snowcast_Server 

(1) RPC pair - Hello + Welcome

Control will call RequestHello to Server

Server will reply with ResponseWelcome



(2) RPC pair - SetStation + Announce

Control will call RequestSetStation (listener port + stationIdx)

Server will reply withResponseAnnounce





# Service2

ServerMsgService

RPCClient: Snowcast_Server

RPCServer: Snowcast_Control

(3) RPC - ReqSendFile + ResponseSendFile

Server will call RequestSendFile(songname)

Control will reply with ResponseSendFile



(4) RPC - ReqShutdown + ResponseShutdown

Server will call RequestShutdown(stationIdx)

Control will reply ResposneShutdown



# Notice1-control has listener Port

snowcast_server needs to call RPC on snowcast_control

according to gRPC, the rpcServer must have listener

so we need to initialize listener for snowcast_control

listenerPort for control1 is 23333

listenerPort for control2 is 24444



# Notice2-server needs to record service2Client to call RPC

snowcast_server needs to call RPC (service2) for many controls

=>

a single snowcast_server may have multiple rpc service2 clients

=>

```go
Control2SRPCClient  map[string]rpcMsg.ServerMsgServiceClient
// controlname 2 RPC client
```



# Discussion

(1) gRPC is great

(2) how great



# Challenge

conn => bidirectional

RPC => single direction



control => RPC =>  server: easy

server => RPC => control: difficult



solution: 

(1) add some information to RPC that control sends to server

(2) servers create RPC client using information just received



# Interesting

(1)

gRPC is based on TCP

you need to build conn

UDP port cannot be replaced



(2)

we need override the code generated by proto compiler

if you do not follow the template, you cannot register the functions correctly

